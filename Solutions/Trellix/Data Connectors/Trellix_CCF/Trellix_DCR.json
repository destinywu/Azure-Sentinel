{
  "name": "TrellixDCR",
  "apiVersion": "2023-03-11",
  "type": "Microsoft.Insights/dataCollectionRules",
  "location": "{{location}}",
  "properties": {
    "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
    "streamDeclarations": {
      "Custom-TrellixEvents_CL": {
        "columns": [
          {
            "name": "id",
            "type": "string"
          },
          {
            "name": "type",
            "type": "string"
          },
          {
            "name": "attributes",
            "type": "dynamic"
          }
        ]
      }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "{{workspaceResourceId}}",
          "name": "clv2ws1"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-TrellixEvents_CL"
        ],
        "destinations": [
          "clv2ws1"
        ],
        "outputStream": "Custom-TrellixEvents_CL",
        "transformKql": "source  | project TimeGenerated=now(),Id=tostring(id),EventType=tostring(type),AutoGuid=tostring(attributes.autoguid),DetectedUtc=datetime(1970-01-01)+(tolong(attributes.detectedutc)*1ms),ReceivedUtc=datetime(1970-01-01)+(tolong(attributes.receivedutc)*1ms),AgentGuid=tostring(attributes.agentguid),Analyzer=tostring(attributes.analyzer),AnalyzerName=tostring(attributes.analyzername),AnalyzerVersion=tostring(attributes.analyzerversion),AnalyzerHostName=tostring(attributes.analyzerhostname),AnalyzerIPv4=tostring(attributes.analyzeripv4),AnalyzerIPv6=tostring(attributes.analyzeripv6),AnalyzerMac=tostring(attributes.analyzermac),AnalyzerDatVersion=tostring(attributes.analyzerdatversion),AnalyzerEngineVersion=tostring(attributes.analyzerengineversion),AnalyzerDetectionMethod=tostring(attributes.analyzerdetectionmethod),SourceHostName=tostring(attributes.sourcehostname),SourceIPv4=tostring(attributes.sourceipv4),SourceIPv6=tostring(attributes.sourceipv6),SourceMac=tostring(attributes.sourcemac),SourceUserName=tostring(attributes.sourceusername),SourceProcessName=tostring(attributes.sourceprocessname),SourceUrl=tostring(attributes.sourceurl),TargetHostName=tostring(attributes.targethostname),TargetIPv4=tostring(attributes.targetipv4),TargetIPv6=tostring(attributes.targetipv6),TargetMac=tostring(attributes.targetmac),TargetUserName=tostring(attributes.targetusername),TargetPort=tostring(attributes.targetport),TargetProtocol=tostring(attributes.targetprotocol),TargetProcessName=tostring(attributes.targetprocessname),TargetFileName=tostring(attributes.targetfilename),ThreatCategory=tostring(attributes.threatcategory),ThreatEventId=toint(attributes.threateventid),ThreatSeverity=tostring(attributes.threatseverity),ThreatName=tostring(attributes.threatname),ThreatType=tostring(attributes.threattype),ThreatActionTaken=tostring(attributes.threatactiontaken),ThreatHandled=tobool(attributes.threathandled),Timestamp=todatetime(attributes.timestamp),NodePath=tostring(attributes.nodepath),TargetHash=tostring(attributes.targethash)"
      }
    ]
  }
}