{
  "type": "Microsoft.SecurityInsights/dataConnectors",
  "apiVersion": "2022-10-01-preview",
  "name": "TrellixPoller",
  "location": "{{location}}",
  "kind": "RestApiPoller",
  "properties": {
    "auth": {
      "type": "OAuth2",
      "ClientId": "clientId",
      "ClientSecret": "clientSecret",
      "GrantType": "client_credentials",
      "TokenEndpoint": "[[parameters('trellixAuthTokenUrl')]",
      "Scope": "epo.device.r epo.device.w epo.tags.r epo.tags.w epo.evt.r",
      "TokenEndpointHeaders": {
        "Content-Type": "application/x-www-form-urlencoded",
        "Authorization": "[[concat('Basic ',base64(concat(parameters('clientId'),':',parameters('clientSecret'))))]"
      }
    },
    "request": {
      "apiEndpoint": "[[concat(parameters('trellixApiBaseUrl'), '/epo/v2/events')]",
      "httpMethod": "GET",
      "rateLimitQPS": 3,
      "queryWindowInMin": 30,
      "retryCount": 3,
      "timeoutInSeconds": 30,
      "headers": {
        "User-Agent": "MS-Sentinel-CCF-Trellix",
        "Content-Type": "application/vnd.api+json",
        "Accept": "application/json",
        "x-api-key": "[[parameters('apiKey')]"
      },
      "queryParameters": {
        "page[limit]": "1000",
        "sort": "timestamp",
        "filter[timestamp][GE]": "{_QueryWindowStartTime}"
      }
    },
    "response": {
      "eventsJsonPaths": [
        "$.data[*]"
      ],
      "format": "json"
    },
    "paging": {
      "pagingType": "NextPageUrl",
      "nextPageUrl": "[[parameters('trellixApiBaseUrl')]",
      "nextPageTokenJsonPath": "$.links.next",
      "isNextPageTokenRelativeUrl": true
    },
    "connectorDefinitionName": "TrellixConnector",
    "dataType": "TrellixEvents",
    "dcrConfig": {
      "streamName": "Custom-TrellixEvents_CL",
      "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
      "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}"
    }
  }
}