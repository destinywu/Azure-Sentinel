{
    "handler": "Microsoft.Azure.CreateUIDef",
    "parameters": {
        "config": {
            "basics": {
                "resourceGroup": {
                    "allowExisting": true
                },
                "description": "**Note:** Please refer to the following before installing the solution: \n\n- Review the solution [Release Notes](https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Trellix-Preview/ReleaseNotes.md)\n\n- There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing.\n\n**Data Connectors:** 1, **Parsers:** 1\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
                "location": {
                    "metadata": {
                        "hidden": "Hiding location, we get it from the log analytics workspace"
                    },
                    "visible": false
                },
                "subscription": {
                    "resourceProviders": [
                        "Microsoft.OperationsManagement/solutions",
                        "Microsoft.OperationalInsights/workspaces/providers/alertRules",
                        "Microsoft.Insights/workbooks",
                        "Microsoft.Logic/workflows"
                    ]
                }
            },
            "isWizard": false
        },
        "outputs": {
            "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
            "location": "[location()]",
            "workspace": "[basics('workspace')]"
        },
        "steps": [
            {
                "label": "Data Connectors",
                "name": "dataconnectors",
                "elements": [
                    {
                        "name": "dataconnectors1-text",
                        "options": {
                            "text": "This solution installs the data connector for Trellix-Preview. You can get Trellix-Preview data in your Microsoft Sentinel workspace. After installing the solution, configure and enable this data connector by following guidance in Manage solution view."
                        },
                        "type": "Microsoft.Common.TextBlock"
                    },
                    {
                        "name": "dataconnectors-link1",
                        "options": {
                            "link": {
                                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources",
                                "label": "Learn more about connecting data sources"
                            }
                        },
                        "type": "Microsoft.Common.TextBlock"
                    }
                ],
                "bladeTitle": "Data Connectors"
            }
        ],
        "basics": [
            {
                "name": "getLAWorkspace",
                "type": "Microsoft.Solutions.ArmApiControl",
                "toolTip": "This filters by workspaces that exist in the Resource Group selected",
                "condition": "[greater(length(resourceGroup().name),0)]",
                "request": {
                    "method": "GET",
                    "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
                }
            },
            {
                "name": "workspace",
                "type": "Microsoft.Common.DropDown",
                "label": "Workspace",
                "placeholder": "Select a workspace",
                "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
                "constraints": {
                    "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
                    "required": true
                },
                "visible": true
            }
        ]
    },
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "version": "0.1.2-preview"
}